<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ùêáùêéùêãùêéùêÜùêëùêÄùêå ùêÇùêéùêàùêç</title>

  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

  <style>
    /* Seu CSS continua o mesmo */
    body { font-family: sans-serif; margin: 0; }
    #initialMessage {
      position: fixed; top: calc(50% + 100px); left: 50%; transform: translate(-50%, -50%); padding: 20px;
      background-color: rgba(0, 0, 0, 0.85); color: white; border-radius: 10px; text-align: center;
      font-size: 18px; z-index: 1001; max-width: 90%; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    #playPauseButton {
      position: fixed; top: 20px; left: 20px; z-index: 999; background-color: rgba(0, 0, 0, 0.42);
      border: none; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;
      display: inline-flex; align-items: center; gap: 4px; color: white;
    }
    #playPauseButton.is-playing { padding: 10px 20px; }
    #playPauseButton.is-paused { padding: 2px 6px; }
    #playPauseButton .icon { color: #28a745; }
    #playPauseButton.is-playing .icon { font-size: 24px; }
    #playPauseButton.is-paused .icon { font-size: 44px; position: relative; bottom: 3px; left: 5px; }
    #playPauseButton .text { font-size: 16px; }
    #playPauseButton.rotating { transform: rotate(360deg); }
    #playPauseButton:hover { background-color: rgba(0, 0, 0, 0.6); transform: scale(1.05); }
    #central-button-container {
      position: fixed; bottom: 100px; left: 50%; transform: translateX(calc(-50% - 8px)); z-index: 999;
    }
    .prosperity-button {
      display: flex; align-items: center; justify-content: center; width: 51.84px; height: 51.84px;
      background-color: #28a745; color: white; border-radius: 50%; font-size: 30px;
      font-weight: bold; text-decoration: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.3s ease;
    }
    .prosperity-button:hover { transform: scale(1.1); }
    #footerSocial {
      position: fixed; bottom: 0; left: 0; right: 0; padding: 20px 0; display: flex;
      justify-content: center; align-items: center; gap: 40px; z-index: 998;
      background-color: rgba(0, 0, 0, 0.1); box-shadow: 0 0 19.5px rgba(0, 0, 0, 0.47);
    }
    #footerSocial a { display: flex; align-items: center; justify-content: center; width: 34.56px; height: 34.56px; text-decoration: none; }
    #footerSocial svg { width: 100%; height: 100%; transition: transform 0.3s ease; }
    #footerSocial a:hover svg { transform: scale(1.1); }
    #footerSocial a.instagram { width: 41.47px; height: 41.47px; }
    #footerSocial a.telegram, #footerSocial a.telegram svg { width: 51.84px; height: 51.84px; }
    #footerSocial .twitter svg { fill: #000000; } 
    #footerSocial .instagram svg { fill: #833AB4; }
    #footerSocial .telegram svg { fill: #0088cc; }
  </style>
</head>

<body>

  <div id="initialMessage">Point your phone forward to watch the video, then click Play.</div>
  <button id="playPauseButton" class="is-paused"><span class="icon">‚ñ∂Ô∏é</span> <span class="text">Play</span></button>

  <a-scene vr-mode-ui="enabled: false">
    <a-assets>
      <video id="Video_Asset_0" src="assets/hannah.webm" playsinline webkit-playsinline></video>
      <img id="imagem-final-asset" src="assets/hannah.png">
    </a-assets>
    <a-entity id="video-inicial-entity" position="0 1 -8" look-at="[camera]" visible="true">
      <a-video width="7" height="7" material="shader: flat; src: #Video_Asset_0; transparent: true;"></a-video>
    </a-entity>
    <a-entity id="imagem-final-entity" position="0 1 -8" look-at="[camera]" visible="false">
      <a-image src="#imagem-final-asset" width="5" height="5" material="transparent: true;"></a-image>
      <a-text value="BUY ME NOW.\nCLICK ON THE GREEN BUTTON BELOW." align="center" color="white" width="10" position="0 -3 0"></a-text>
    </a-entity>
    <a-camera id="camera1"></a-camera>
  </a-scene>

  <div id="central-button-container">
    <a href="https://pump.fun/coin/4DEC6sboxXviCsygyuvJ4nSGmrSvSQPtadDgGnGdpump" target="_blank" rel="noopener noreferrer" class="prosperity-button" aria-label="Link Prosperidade">Ê†Ñ</a>
  </div>

  <div id="footerSocial">
    <a href="https://x.com/HologramCrypto" target="_blank" class="twitter" aria-label="Twitter"><svg viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 7.184L18.901 1.153zm-1.61 19.932h2.527L5.41 2.544H2.748l14.543 18.54z"/></svg></a>
    <a href="https://www.instagram.com/jeantedesqui/" target="_blank" class="instagram" aria-label="Instagram"><svg viewBox="0 0 24 24"><path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm0 2h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3zm5 3a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg></a>
    <a href="https://t.me/wild_dream91" target="_blank" class="telegram" aria-label="Telegram"><svg viewBox="0 0 24 24"><path d="M9.993 15.674c-.18 0-.328-.053-.449-.16-.121-.106-.188-.244-.2-.413l-.356-3.395-2.49-1.14c-.231-.101-.361-.257-.388-.466-.027-.21.047-.38.22-.507L17.587 4.18c.179-.117.374-.15.583-.097.21.053.351.17.422.352.07.182.058.368-.038.556l-5.304 10.596c-.096.185-.237.31-.42.375-.183.066-.366.052-.55-.042l-2.202-1.112-.685 1.76c-.057.144-.156.253-.295.327-.139.075-.283.112-.431.112zm.538-5.283l.395 3.774 1.453-.76 2.437 1.23 4.139-8.272-8.424 4.028z"/></svg></a>
  </div>

  <script>
    // --- Refer√™ncias aos elementos ---
    const video = document.querySelector('#Video_Asset_0');
    const playPauseButton = document.getElementById('playPauseButton');
    const videoEntity = document.querySelector('#video-inicial-entity');
    const imageEntity = document.querySelector('#imagem-final-entity');

    // --- L√≥gica original do seu site ---
    window.addEventListener('load', () => {
      const message = document.getElementById('initialMessage');
      if (message) {
        setTimeout(() => { message.style.display = 'none'; }, 6000);
      }
    });

    playPauseButton.addEventListener('click', () => {
      // ALTERA√á√ÉO: Pedir permiss√£o na primeira intera√ß√£o do usu√°rio
      requestNotificationPermissionAndRegisterSW();

      if (video.paused) {
        if (imageEntity.getAttribute('visible')) {
          imageEntity.setAttribute('visible', 'false');
          videoEntity.setAttribute('visible', 'true');
        }
        video.muted = false;
        video.play();
        playPauseButton.innerHTML = '<span class="icon">‚è∏Ô∏é</span> <span class="text">Pause</span>';
        playPauseButton.classList.replace('is-paused', 'is-playing');
      } else {
        video.pause();
        playPauseButton.innerHTML = '<span class="icon">‚ñ∂Ô∏é</span> <span class="text">Play</span>';
        playPauseButton.classList.replace('is-playing', 'is-paused');
      }
      playPauseButton.classList.add('rotating');
      setTimeout(() => playPauseButton.classList.remove('rotating'), 300);
    });

    video.addEventListener('ended', function() {
      videoEntity.setAttribute('visible', 'false');
      imageEntity.setAttribute('visible', 'true');
      playPauseButton.innerHTML = '<span class="icon">‚ñ∂Ô∏é</span> <span class="text">Play</span>';
      playPauseButton.classList.replace('is-playing', 'is-paused');
    });

    // =======================================================
    // --- NOVO C√ìDIGO PARA NOTIFICA√á√ÉO LOCAL (CORRIGIDO) ---
    // =======================================================

    let permissionRequested = false; // Flag para garantir que a permiss√£o seja pedida apenas uma vez

    async function requestNotificationPermissionAndRegisterSW() {
      if (permissionRequested || !('serviceWorker' in navigator) || !('Notification' in window)) {
        return; // Sai se a permiss√£o j√° foi pedida ou se o navegador n√£o suporta os recursos
      }
      permissionRequested = true; // Marca que a tentativa foi feita

      try {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          console.log('Permiss√£o para notifica√ß√µes concedida.');
          await navigator.serviceWorker.register('./service-worker.js');
          console.log('Service Worker registrado com sucesso.');
        } else {
          console.log('Permiss√£o para notifica√ß√µes negada.');
        }
      } catch (error) {
        console.error('Erro ao registrar Service Worker ou pedir permiss√£o:', error);
      }
    }

    // ALTERA√á√ÉO: Usar 'visibilitychange' em vez de 'unload'
    document.addEventListener('visibilitychange', () => {
      // Verifica se a p√°gina ficou oculta (usu√°rio trocou de aba, minimizou, etc.)
      if (document.visibilityState === 'hidden') {
        if (navigator.serviceWorker && navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({
            action: 'schedule-notification'
          });
          console.log('Mensagem para agendar notifica√ß√£o enviada ao Service Worker.');
        }
      }
    });
  </script>
</body>
</html>
